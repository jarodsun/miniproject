# **项目名称：简易CRM及进销存分析系统 - Web前端应用**

## **1. 项目概述**

本系统是一个基于 Next.js 15 + Material-UI 的现代化 Web 前端应用，为用户提供一个轻量级的客户管理（CRM）与进销存（Inventory）解决方案。核心功能包括用户认证、货品出入库管理和基于历史数据的商家采购行为分析，帮助用户预测未来销售旺季。

## **2. 核心功能模块**

### **模块零：用户认证系统 (User Authentication)**

#### **0.1 用户登录 (User Login)**
*   **功能描述：** 用户通过用户名和密码进行系统登录。
*   **具体需求：**
    *   **登录界面：** 提供简洁美观的登录表单，包含电子邮箱和密码输入框，支持主题切换（深色/浅色模式）。
    *   **表单验证：** 对电子邮箱格式和密码长度进行实时验证，显示错误提示信息。
    *   **登录验证：** 通过 API 验证用户凭据的有效性，支持 JWT 令牌认证。
    *   **用户体验：** 登录过程中显示加载状态，防止重复提交，自动聚焦到邮箱输入框。
    *   **错误处理：** 登录失败时显示友好的错误提示信息。
    *   **登录状态管理：** 登录成功后自动跳转到 Dashboard 主界面，已登录用户访问登录页会自动重定向。
    *   **安全退出：** 在 Dashboard 侧边菜单提供安全退出功能，清除用户会话和本地存储。
    *   **主题持久化：** 用户选择的主题模式会被保存，下次访问时自动应用。

#### **0.2 用户界面设计**
*   **功能描述：** 提供现代化的用户界面体验。
*   **具体需求：**
    *   **响应式设计：** 支持桌面端和移动端访问。
    *   **主题切换：** 支持明暗主题切换。
    *   **Material Design：** 采用 Material-UI 设计规范。
    *   **无障碍访问：** 支持键盘导航和屏幕阅读器。

### **模块一：基础信息管理**

#### **1.1 货品管理 (Product Management)**
*   **功能描述：** 统一管理所有货品信息。
*   **具体需求：**
    *   **添加货品：** 录入新品信息，如货品名称、规格、单位（如：个、箱）、初始库存等。
    *   **查看货品列表：** 展示所有货品的列表，包含当前库存数量。
    *   **修改货品信息：** 编辑已存在的货品信息。
    *   **删除货品：** 删除不再使用的货品。
    *   **上传图片：** 为每个货品上传一张或多张图片，用于展示。此功能将通过专门的图片上传 API 实现。
    *   **搜索筛选：** 支持按货品名称、规格等条件搜索和筛选。

#### **1.2 商家管理 (Merchant Management)**
*   **功能描述：** 统一管理所有合作商家的信息。
*   **具体需求：**
    *   **添加商家：** 录入新商家的信息，如商家名称、联系人、联系电话等。
    *   **查看商家列表：** 展示所有商家的列表。
    *   **修改商家信息：** 编辑已存在的商家信息。
    *   **删除商家：** 删除不再合作的商家。
    *   **搜索筛选：** 支持按商家名称、联系人等条件搜索和筛选。

### **模块二：出入库管理 (Inventory Transactions)**

#### **2.1 入库功能 (Stock-in)**
*   **功能描述：** 记录货品进入仓库的操作。
*   **具体需求：**
    *   创建入库单：选择要入库的`货品`，填写`数量`和`日期`。
    *   完成后，对应货品的`当前库存`会自动增加。
    *   **批量入库：** 支持一次选择多个货品进行入库操作。
    *   **入库历史：** 查看所有入库记录，支持按日期、货品等条件筛选。

#### **2.2 出库功能 (Stock-out)**
*   **功能描述：** 记录货品从仓库发出给指定商家的操作。
*   **具体需求：**
    *   创建出库单：选择要出库的`货品`，填写`数量`和`日期`。
    *   **关键点：** 必须关联一个`商家`，以记录该批货物发往何处。
    *   完成后，对应货品的`当前库存`会自动减少。
    *   **库存检查：** 出库前检查库存是否充足，防止超量出库。
    *   **批量出库：** 支持一次选择多个货品进行出库操作。

#### **2.3 库存流水查看**
*   **功能描述：** 提供所有出入库历史记录的查询。
*   **具体需求：**
    *   可以按日期、货品、商家、类型（出库/入库）等条件筛选和查看所有历史记录。
    *   **数据导出：** 支持将库存流水数据导出为 Excel 或 CSV 格式。
    *   **实时更新：** 库存数据实时更新，确保数据准确性。

### **模块三：销售分析与预测 (Sales Analysis & Prediction)**

#### **3.1 商家年度采购趋势分析**
*   **功能描述：** 以商家的维度，用图表形式展示该商家近一年的进货（出库）情况，并分析其采购规律。
*   **核心需求：**
    *   **数据统计：** 系统能够按`商家`和`月份`对所有`出库记录`进行汇总。
    *   **报表生成：**
        *   用户选择一个`商家`。
        *   系统生成一份**图表**（如柱状图或折线图），展示该商家在**过去12个月**（近一年）的每月总采购数量。
        *   **数据洞察：** 通过此图表，用户可以直观地看到该商家在不同月份的采购量变化趋势，识别出采购高峰期，从而预测其未来的大宗进货需求。
        *   **高亮显示：** 在图表中，自动高亮或标记出采购量远超平均水平的月份，将其识别为"大量进货需求"月份。

#### **3.2 库存预警系统**
*   **功能描述：** 基于历史数据分析，提供库存预警功能。
*   **具体需求：**
    *   **低库存预警：** 当货品库存低于设定阈值时，系统自动提醒。
    *   **采购建议：** 根据历史销售数据，建议采购数量和时机。
    *   **趋势预测：** 基于历史数据预测未来销售趋势。

### **模块四：系统管理 (System Management)**

#### **4.1 用户管理**
*   **功能描述：** 管理系统用户账户。
*   **具体需求：**
    *   **用户注册：** 支持新用户注册功能。
    *   **用户信息管理：** 用户可以修改个人信息。
    *   **权限管理：** 不同用户角色具有不同的系统权限。

#### **4.2 系统设置**
*   **功能描述：** 提供系统配置和个性化设置。
*   **具体需求：**
    *   **主题设置：** 用户可以选择喜欢的界面主题。
    *   **语言设置：** 支持多语言界面切换。
    *   **通知设置：** 用户可以自定义系统通知偏好。

## **3. 技术架构**

### **3.1 技术栈架构**

#### **3.1.1 前端技术栈**
*   **框架：** Next.js 15 (App Router + Pages Router)
*   **UI 库：** Material-UI v7
*   **样式：** Emotion + Tailwind CSS
*   **状态管理：** React Context + Hooks
*   **图表库：** @mui/x-charts
*   **数据网格：** @mui/x-data-grid
*   **日期处理：** dayjs

#### **3.1.2 后端技术栈**
*   **数据库：** SQLite (轻量级嵌入式数据库)
*   **ORM：** Prisma (现代化数据库工具包)
*   **API：** Next.js API Routes (Pages Router模式)
*   **认证：** JWT 认证
*   **密码加密：** bcryptjs (安全的密码哈希算法)
*   **文件存储：** 本地文件系统

#### **3.1.3 开发工具**
*   **数据库管理：** Prisma Studio
*   **类型安全：** TypeScript + Prisma 类型生成
*   **代码规范：** ESLint + Prettier
*   **版本控制：** Git

#### **3.1.4 依赖包管理**
```bash
# 核心依赖
npm install prisma @prisma/client
npm install bcryptjs jsonwebtoken
npm install @types/bcryptjs @types/jsonwebtoken --save-dev

# 数据库迁移
npx prisma generate
npx prisma migrate dev --name init
```

#### **3.1.5 环境变量配置**
```bash
# 生成JWT密钥
openssl rand -base64 32

# 生成NextAuth密钥
openssl rand -base64 32

# 一键生成环境变量文件
echo "JWT_SECRET=$(openssl rand -base64 32)" >> .env.local
echo "NEXTAUTH_SECRET=$(openssl rand -base64 32)" >> .env.local
echo "DATABASE_URL=\"file:./dev.db\"" >> .env.local
echo "NEXTAUTH_URL=\"http://localhost:3000\"" >> .env.local
```

#### **3.1.6 API开发模式**
*   **API路由：** 使用 Next.js Pages Router 模式开发 RESTful API
*   **认证系统：** JWT + bcryptjs 提供安全的用户认证
*   **数据库操作：** Prisma ORM 提供类型安全的数据库查询
*   **错误处理：** 统一的错误响应格式和状态码
*   **安全特性：** 密码加密、会话管理、令牌验证

### **3.2 项目结构**

#### **3.2.1 目录结构**
```
crm/website/
├── app/                          # Next.js App Router (前端页面)
│   ├── components/               # 共享组件
│   ├── dashboard/               # 仪表板模块
│   ├── shared-theme/            # 主题配置
│   └── page.tsx                 # 首页 (登录页)
├── pages/                        # Next.js Pages Router (API路由)
│   ├── api/                     # API接口
│   │   └── auth/                # 认证相关API
│   │       ├── login.ts         # 用户登录API
│   │       ├── logout.ts        # 用户登出API
│   │       └── verify.ts        # 令牌验证API
│   └── api-test.tsx             # API测试页面
├── prisma/                      # 数据库配置
│   ├── schema.prisma            # 数据库模式
│   └── seed.ts                  # 种子数据
├── Docs/                        # 项目文档
│   ├── requirements.md          # 需求文档
│   ├── database-design.md       # 数据库设计
│   └── README.md                # 项目说明
├── package.json                 # 项目配置
├── env.example                  # 环境变量示例
└── tsconfig.json               # TypeScript配置
```

#### **3.2.2 架构说明**
*   **前端架构：** 使用 Next.js App Router 构建现代化前端应用
*   **API架构：** 使用 Next.js Pages Router 模式开发 RESTful API
*   **数据库架构：** SQLite + Prisma ORM 提供类型安全的数据库操作
*   **认证架构：** JWT + bcryptjs 提供安全的用户认证系统

### **3.3 数据库设计**
详细的数据库设计请参考：[数据库设计文档](./database-design.md)

**主要技术选型：**
*   **数据库：** SQLite (轻量级嵌入式数据库)
*   **ORM：** Prisma (现代化数据库工具包)
*   **类型安全：** 自动生成 TypeScript 类型
*   **开发体验：** Prisma Studio 可视化数据库管理

## **4. 用户界面设计规范**

### **4.1 设计原则**
*   **简洁性：** 界面简洁明了，操作流程清晰。
*   **一致性：** 统一的视觉语言和交互模式。
*   **响应性：** 适配不同设备和屏幕尺寸。
*   **可访问性：** 支持无障碍访问。

### **4.2 页面结构**
*   **登录页：** 简洁的登录表单，支持主题切换。
*   **主界面：** 侧边导航 + 主内容区域布局。
*   **数据展示：** 使用表格、图表等组件展示数据。
*   **表单页面：** 统一的表单设计规范。

## **5. 安全要求**

### **5.1 认证安全**
*   **密码加密：** 使用 bcryptjs 对用户密码进行哈希加密存储，盐值轮数设置为 10。
*   **会话管理：** 实现安全的用户会话管理，使用 JWT 令牌进行身份验证。
*   **登录保护：** 防止暴力破解攻击，实现登录失败次数限制。
*   **密码策略：** 要求用户设置强密码，包含字母、数字和特殊字符。

### **5.2 数据安全**
*   **数据验证：** 所有用户输入必须进行验证。
*   **权限控制：** 不同用户只能访问授权功能。
*   **数据备份：** 重要数据需要定期备份。

## **6. 性能要求**

### **6.1 响应时间**
*   **页面加载：** 首屏加载时间 < 3秒
*   **数据查询：** 数据查询响应时间 < 2秒
*   **用户交互：** 用户操作响应时间 < 1秒

### **6.2 并发支持**
*   **多用户：** 支持多用户同时在线操作。
*   **数据一致性：** 确保多用户操作时数据的一致性。


---

**文档版本：** v1.6  
**创建日期：** 2025年10月5日  
**最后更新：** 2025年10月7日  
**更新内容：** 更新用户认证模块要求

## **相关文档**
- [数据库设计文档](./database-design.md) - 详细的数据库设计和配置说明
- [项目README](./README.md) - 项目结构和技术栈说明
